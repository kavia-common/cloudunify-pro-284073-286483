{"is_source_file": true, "format": "JavaScript", "description": "This file implements PostgreSQL database connection management and schema setup functions for a backend project. It handles connection pooling, environment configuration, and creates necessary tables and indexes such as organizations, users, and resources. It also includes utilities for sanitizing database URLs for logging and gracefully shutting down the connection pool.", "external_files": ["pg"], "external_methods": ["require('pg').Pool"], "published": ["query", "ensureSchema", "closePool", "pool"], "classes": [], "methods": [{"name": "sanitizeDatabaseUrl(raw)", "description": "Sanitizes database URL by masking username and password for safe logging.", "scope": "", "scopeKind": ""}, {"name": "query(text, params)", "description": "Executes parameterized SQL queries using a shared connection pool.", "scope": "", "scopeKind": ""}, {"name": "ensureSchema()", "description": "Creates necessary database tables and indexes if they do not exist.", "scope": "", "scopeKind": ""}, {"name": "closePool()", "description": "Closes the database connection pool gracefully.", "scope": "", "scopeKind": ""}], "calls": ["console.log", "pool.on('error')", "query()"], "search-terms": ["PostgreSQL", "index", "schema", "connection pooling", "tables", "resources", "users", "organizations"], "state": 2, "file_id": 13, "knowledge_revision": 105, "git_revision": "d6ac97d15f4d02579c0f481d230ed0d938353af3", "revision_history": [{"27": ""}, {"39": ""}, {"78": "cdc4522b98f6436807c26ddb5ccd4c7d40f42e85"}, {"84": "cdc4522b98f6436807c26ddb5ccd4c7d40f42e85"}, {"103": "dba4240178822cb1fce1c0a7a0aa20147e9b5078"}, {"105": "d6ac97d15f4d02579c0f481d230ed0d938353af3"}], "ctags": [{"_type": "tag", "name": "application_name", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  application_name: process.env.PGAPPNAME || 'cloudunify-pro-backend',$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts", "scopeKind": "class"}, {"_type": "tag", "name": "basePoolOpts", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^const basePoolOpts = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "closePool", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^async function closePool() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "connectionTimeoutMillis", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  connectionTimeoutMillis: parseInt(process.env.PGCONNECT_TIMEOUT_MS || '5000', 10),$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts", "scopeKind": "class"}, {"_type": "tag", "name": "ensureSchema", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^async function ensureSchema() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "hasDatabaseUrl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^const hasDatabaseUrl = !!process.env.DATABASE_URL;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "idleTimeoutMillis", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  idleTimeoutMillis: parseInt(process.env.PGIDLE_TIMEOUT_MS || '30000', 10),$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts", "scopeKind": "class"}, {"_type": "tag", "name": "max", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  max: parseInt(process.env.PGPOOL_MAX || '10', 10),$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts", "scopeKind": "class"}, {"_type": "tag", "name": "pool", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^const pool = new Pool(poolConfig);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "poolConfig", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^const poolConfig = hasDatabaseUrl$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  query,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^async function query(text, params) {$/", "language": "JavaScript", "kind": "function", "signature": "(text, params)"}, {"_type": "tag", "name": "rejectUnauthorized", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  ssl: process.env.PGSSL === 'true' ? { rejectUnauthorized: false } : undefined,$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts.ssl", "scopeKind": "class"}, {"_type": "tag", "name": "sanitizeDatabaseUrl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^function sanitizeDatabaseUrl(raw) {$/", "language": "JavaScript", "kind": "function", "signature": "(raw)"}, {"_type": "tag", "name": "ssl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  ssl: process.env.PGSSL === 'true' ? { rejectUnauthorized: false } : undefined,$/", "language": "JavaScript", "kind": "class", "scope": "basePoolOpts", "scopeKind": "class"}], "hash": "6ef7b9bb7dd3cd339094fdd7af2916b9", "format-version": 4, "code-base-name": "Backend", "filename": "Backend/src/db/index.js", "fields": [{"name": "application_name: process.env.PGAPPNAME || 'cloudunify-pro-backend',", "scope": "basePoolOpts", "scopeKind": "class", "description": "unavailable"}, {"name": "connectionTimeoutMillis: parseInt(process.env.PGCONNECT_TIMEOUT_MS || '5000', 10),", "scope": "basePoolOpts", "scopeKind": "class", "description": "unavailable"}, {"name": "idleTimeoutMillis: parseInt(process.env.PGIDLE_TIMEOUT_MS || '30000', 10),", "scope": "basePoolOpts", "scopeKind": "class", "description": "unavailable"}, {"name": "max: parseInt(process.env.PGPOOL_MAX || '10', 10),", "scope": "basePoolOpts", "scopeKind": "class", "description": "unavailable"}, {"name": "query,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "ssl: process.env.PGSSL === 'true' ? { rejectUnauthorized: false } : undefined,", "scope": "basePoolOpts.ssl", "scopeKind": "class", "description": "unavailable"}]}