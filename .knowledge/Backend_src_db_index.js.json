{"is_source_file": true, "format": "JavaScript", "description": "This file provides a PostgreSQL database connection management module using node-postgres (pg). It includes functions for connection string resolution, schema initialization, query execution, and error handling. The file is tailored for backend database operations within the project, handling environment configurations and schema setup.", "external_files": ["fs", "path", "pg"], "external_methods": ["Pool", "Pool.prototype.query", "Pool.prototype.end"], "published": ["query", "ensureSchema", "closePool", "pool"], "classes": [{"name": "Pool", "description": "A connection pool for PostgreSQL, managing multiple client connections."}], "methods": [{"name": "sanitizeDatabaseUrl(raw)", "description": "Removes sensitive information from a database URL for safe logging.", "scope": "", "scopeKind": ""}, {"name": "readTextSafe(filePath)", "description": "Reads a text file from disk safely, returning null if not found.", "scope": "", "scopeKind": ""}, {"name": "extractDsn(text)", "description": "Extracts the DSN string from given text, typically from a connection file.", "scope": "", "scopeKind": ""}, {"name": "findDbConnectionFile()", "description": "Locates the database connection configuration file among common or environment-specific paths.", "scope": "", "scopeKind": ""}, {"name": "resolvePoolConfig(basePoolOpts)", "description": "Resolves the connection configuration for pg Pool based on environment variables and files.", "scope": "", "scopeKind": ""}, {"name": "query(text, params)", "description": "Executes a parameterized SQL query using the shared connection pool.", "scope": "", "scopeKind": ""}, {"name": "ensureSchema()", "description": "Creates necessary tables and indices if they do not already exist in the database.", "scope": "", "scopeKind": ""}, {"name": "closePool()", "description": "Gracefully shuts down the database connection pool.", "scope": "", "scopeKind": ""}], "calls": ["fs.existsSync", "fs.readFileSync", "fs.readdirSync", "fs.statSync", "pool.query", "pool.end", "console.log", "console.error", "new URL", "path.resolve", "path.dirname", "path.join"], "search-terms": ["PostgreSQL connection pool", "schema setup", "database environment detection", "connection string sanitization", "db_connection.txt", "ensureSchema", "index creation", "resource tables", "user tables", "connection configuration"], "state": 2, "file_id": 13, "knowledge_revision": 119, "git_revision": "d6ac97d15f4d02579c0f481d230ed0d938353af3", "revision_history": [{"27": ""}, {"39": ""}, {"78": "cdc4522b98f6436807c26ddb5ccd4c7d40f42e85"}, {"84": "cdc4522b98f6436807c26ddb5ccd4c7d40f42e85"}, {"103": "dba4240178822cb1fce1c0a7a0aa20147e9b5078"}, {"105": "d6ac97d15f4d02579c0f481d230ed0d938353af3"}, {"111": "d6ac97d15f4d02579c0f481d230ed0d938353af3"}, {"115": "d6ac97d15f4d02579c0f481d230ed0d938353af3"}, {"116": "d6ac97d15f4d02579c0f481d230ed0d938353af3"}, {"117": "d6ac97d15f4d02579c0f481d230ed0d938353af3"}, {"118": "d6ac97d15f4d02579c0f481d230ed0d938353af3"}, {"119": "d6ac97d15f4d02579c0f481d230ed0d938353af3"}], "ctags": [{"_type": "tag", "name": "application_name", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  application_name: process.env.PGAPPNAME || 'cloudunify-pro-backend',$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts", "scopeKind": "class"}, {"_type": "tag", "name": "basePoolOpts", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^const basePoolOpts = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "closePool", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^async function closePool() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "connectionTimeoutMillis", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  connectionTimeoutMillis: parseInt(process.env.PGCONNECT_TIMEOUT_MS || '5000', 10),$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts", "scopeKind": "class"}, {"_type": "tag", "name": "ensureSchema", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^async function ensureSchema() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "extractDsn", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^function extractDsn(text) {$/", "language": "JavaScript", "kind": "function", "signature": "(text)"}, {"_type": "tag", "name": "findDbConnectionFile", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^function findDbConnectionFile() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "fs", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^const fs = require('fs');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "idleTimeoutMillis", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  idleTimeoutMillis: parseInt(process.env.PGIDLE_TIMEOUT_MS || '30000', 10),$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts", "scopeKind": "class"}, {"_type": "tag", "name": "max", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  max: parseInt(process.env.PGPOOL_MAX || '10', 10),$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts", "scopeKind": "class"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^const path = require('path');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "pool", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^const pool = new Pool(poolCfg);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  query,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^async function query(text, params) {$/", "language": "JavaScript", "kind": "function", "signature": "(text, params)"}, {"_type": "tag", "name": "readTextSafe", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^function readTextSafe(filePath) {$/", "language": "JavaScript", "kind": "function", "signature": "(filePath)"}, {"_type": "tag", "name": "rejectUnauthorized", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  ssl: process.env.PGSSL === 'true' ? { rejectUnauthorized: false } : undefined,$/", "language": "JavaScript", "kind": "property", "scope": "basePoolOpts.ssl", "scopeKind": "class"}, {"_type": "tag", "name": "resolvePoolConfig", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^function resolvePoolConfig(basePoolOpts) {$/", "language": "JavaScript", "kind": "function", "signature": "(basePoolOpts)"}, {"_type": "tag", "name": "sanitizeDatabaseUrl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^function sanitizeDatabaseUrl(raw) {$/", "language": "JavaScript", "kind": "function", "signature": "(raw)"}, {"_type": "tag", "name": "ssl", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/src/db/index.js", "pattern": "/^  ssl: process.env.PGSSL === 'true' ? { rejectUnauthorized: false } : undefined,$/", "language": "JavaScript", "kind": "class", "scope": "basePoolOpts", "scopeKind": "class"}], "hash": "b3f19d7a7fe064d39f057e65dabd8c58", "format-version": 4, "code-base-name": "Backend", "filename": "Backend/src/db/index.js", "fields": [{"name": "application_name: process.env.PGAPPNAME || 'cloudunify-pro-backend',", "scope": "basePoolOpts", "scopeKind": "class", "description": "unavailable"}, {"name": "connectionTimeoutMillis: parseInt(process.env.PGCONNECT_TIMEOUT_MS || '5000', 10),", "scope": "basePoolOpts", "scopeKind": "class", "description": "unavailable"}, {"name": "idleTimeoutMillis: parseInt(process.env.PGIDLE_TIMEOUT_MS || '30000', 10),", "scope": "basePoolOpts", "scopeKind": "class", "description": "unavailable"}, {"name": "max: parseInt(process.env.PGPOOL_MAX || '10', 10),", "scope": "basePoolOpts", "scopeKind": "class", "description": "unavailable"}, {"name": "query,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "ssl: process.env.PGSSL === 'true' ? { rejectUnauthorized: false } : undefined,", "scope": "basePoolOpts.ssl", "scopeKind": "class", "description": "unavailable"}]}