{"is_source_file": true, "format": "Python", "description": "This file defines internal API endpoints for seeding database data related to organizations, users, and resources. It includes functions for loading seed data from filesystem files, validating and normalizing input, and performing upsert operations into a PostgreSQL database. Additionally, it provides endpoints for seeding individual entities, all entities, or verifying current seed counts.", "external_files": ["app.db.init_db", "app.db.session", "app.models.tables", "passlib.context"], "external_methods": ["ensure_schema", "get_session"], "published": ["router", "seed_one", "seed_default", "seed_all", "seed_verify", "internal_seed_guard"], "classes": [{"name": "SeedAllBody", "description": "Data model for optional bulk seed input for organizations, users, and resources."}, {"name": "SeedVerifyResponse", "description": "Response model providing seed verification results with counts per entity."}, {"name": "ValidationResult", "description": "Internal dataclass used for validation results during data normalization."}], "methods": [{"name": "List[Dict[str,Any]] load_entity_from_projdefn(entity: str)", "description": "Loads entity data from .projdefn JSON files located in the project directory.", "scope": "", "scopeKind": ""}, {"name": "None internal_seed_guard(request: Request)", "description": "Verifies presence and correctness of X-Seed-Token header in production environment.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] _seed_entity(session: AsyncSession, entity: str, records: Optional[List[Dict[str, Any]]])", "description": "Coordinates the seeding process for a specific entity, including validation and upsert logic.", "scope": "", "scopeKind": ""}, {"name": "ValidationResult _validate_and_normalize(entity: str, records: Any)", "description": "Validates and normalizes raw input data for an entity type, producing structured records or errors.", "scope": "", "scopeKind": ""}, {"name": "Tuple[int,int] _upsert_organizations(session: AsyncSession, records: List[Dict[str, Any]])", "description": "Performs batch upsert (insert/update) operations for organization records.", "scope": "", "scopeKind": ""}, {"name": "Tuple[int,int] _upsert_users_by_id(session: AsyncSession, records: List[Dict[str, Any]])", "description": "Upserts user records identified by their UUIDs.", "scope": "", "scopeKind": ""}, {"name": "Tuple[int,int] _upsert_users_by_email(session: AsyncSession, records: List[Dict[str, Any]])", "description": "Upserts user records identified by email addresses, generating IDs if necessary.", "scope": "", "scopeKind": ""}, {"name": "Tuple[int,int,int] _upsert_resources(session: AsyncSession, records: List[Dict[str, Any]])", "description": "Upserts resource records, handling provider, type, and status fields.", "scope": "", "scopeKind": ""}, {"name": "seed_one( entity: str, body: Optional[List[Dict[str, Any]]] = Body(default=None), _: None = Depends(internal_seed_guard), session: AsyncSession = Depends(get_session), )", "description": "API endpoint to seed a specific entity with provided data or from project files.", "scope": "", "scopeKind": ""}, {"name": "seed_default( body: Optional[SeedAllBody] = Body(default=None), _: None = Depends(internal_seed_guard), session: AsyncSession = Depends(get_session), )", "description": "API endpoint to seed all entities, optionally using provided arrays or project files.", "scope": "", "scopeKind": ""}, {"name": "seed_all( body: Optional[SeedAllBody] = Body(default=None), _: None = Depends(internal_seed_guard), session: AsyncSession = Depends(get_session), )", "description": "API endpoint to seeding all entities in a deterministic sequence.", "scope": "", "scopeKind": ""}, {"name": "SeedVerifyResponse seed_verify( _: None = Depends(internal_seed_guard), session: AsyncSession = Depends(get_session), )", "description": "API endpoint to verify counts of seeded data for each entity.", "scope": "", "scopeKind": ""}, {"name": "bool _bool_env(name: str)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[Path] _find_projdefn_root()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool _is_email(s: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool _is_production()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool _is_uuid_str(s: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] _normalize_resource_status(s: Optional[str])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "datetime _now()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "datetime _to_datetime(val: Any)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[Path] _walk_json_files(root: Path)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["json.loads", "os.getenv", "Path().is_dir", "Path().iterdir", "select", "func.count", "session.execute", "session.scalar", "load_entity_from_projdefn", "ensure_schema", "get_session", "_normalize_resource_status", "_validate_and_normalize", "_upsert_organizations", "_upsert_users_by_id", "_upsert_users_by_email", "_upsert_resources"], "search-terms": ["seed endpoint", "internal seed", "POST /_internal/seed", "seeding database", "load from projdefn", "upsert organizations", "upsert users", "upsert resources", "verification counts", "batch seed"], "state": 2, "file_id": 56, "knowledge_revision": 181, "git_revision": "", "ctags": [{"_type": "tag", "name": "ENTITIES", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^ENTITIES = (\"organizations\", \"users\", \"resources\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SeedAllBody", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^class SeedAllBody(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SeedVerifyResponse", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^class SeedVerifyResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ValidationResult", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^class ValidationResult:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_bool_env", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _bool_env(name: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(name: str)"}, {"_type": "tag", "name": "_find_projdefn_root", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _find_projdefn_root() -> Optional[Path]:$/", "language": "Python", "typeref": "typename:Optional[Path]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_is_email", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _is_email(s: Any) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(s: Any)"}, {"_type": "tag", "name": "_is_production", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _is_production() -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_is_uuid_str", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _is_uuid_str(s: Any) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(s: Any)"}, {"_type": "tag", "name": "_normalize_resource_status", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _normalize_resource_status(s: Optional[str]) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(s: Optional[str])"}, {"_type": "tag", "name": "_now", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _now() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_pwd_ctx", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^_pwd_ctx = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_seed_entity", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def _seed_entity(session: AsyncSession, entity: str, records: Optional[List[Dict[str, Any]/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(session: AsyncSession, entity: str, records: Optional[List[Dict[str, Any]]])"}, {"_type": "tag", "name": "_to_datetime", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _to_datetime(val: Any) -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "(val: Any)"}, {"_type": "tag", "name": "_upsert_organizations", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def _upsert_organizations(session: AsyncSession, records: List[Dict[str, Any]]) -> Tuple[i/", "language": "Python", "typeref": "typename:Tuple[int,int]", "kind": "function", "signature": "(session: AsyncSession, records: List[Dict[str, Any]])"}, {"_type": "tag", "name": "_upsert_resources", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def _upsert_resources(session: AsyncSession, records: List[Dict[str, Any]]) -> Tuple[int, /", "language": "Python", "typeref": "typename:Tuple[int,int,int]", "kind": "function", "signature": "(session: AsyncSession, records: List[Dict[str, Any]])"}, {"_type": "tag", "name": "_upsert_users_by_email", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def _upsert_users_by_email(session: AsyncSession, records: List[Dict[str, Any]]) -> Tuple[/", "language": "Python", "typeref": "typename:Tuple[int,int]", "kind": "function", "signature": "(session: AsyncSession, records: List[Dict[str, Any]])"}, {"_type": "tag", "name": "_upsert_users_by_id", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def _upsert_users_by_id(session: AsyncSession, records: List[Dict[str, Any]]) -> Tuple[int/", "language": "Python", "typeref": "typename:Tuple[int,int]", "kind": "function", "signature": "(session: AsyncSession, records: List[Dict[str, Any]])"}, {"_type": "tag", "name": "_validate_and_normalize", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _validate_and_normalize(entity: str, records: Any) -> ValidationResult:$/", "language": "Python", "typeref": "typename:ValidationResult", "kind": "function", "signature": "(entity: str, records: Any)"}, {"_type": "tag", "name": "_walk_json_files", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def _walk_json_files(root: Path) -> List[Path]:$/", "language": "Python", "typeref": "typename:List[Path]", "kind": "function", "signature": "(root: Path)"}, {"_type": "tag", "name": "counts", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^    counts: Dict[str, int] = Field(..., description=\"Counts by entity and total\")$/", "language": "Python", "typeref": "typename:Dict[str, int]", "kind": "variable", "scope": "SeedVerifyResponse", "scopeKind": "class"}, {"_type": "tag", "name": "internal_seed_guard", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def internal_seed_guard(request: Request) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "load_entity_from_projdefn", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^def load_entity_from_projdefn(entity: str) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "(entity: str)"}, {"_type": "tag", "name": "ok", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^    ok: bool = Field(True, description=\"Indicates success\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "SeedVerifyResponse", "scopeKind": "class"}, {"_type": "tag", "name": "organizations", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^    organizations: Optional[List[Dict[str, Any]]] = Field(None, description=\"Array of organizati/", "language": "Python", "typeref": "typename:Optional[List[Dict[str, Any]]]", "kind": "variable", "scope": "SeedAllBody", "scopeKind": "class"}, {"_type": "tag", "name": "pg_insert", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^from sqlalchemy.dialects.postgresql import insert as pg_insert$/", "language": "Python", "kind": "unknown", "nameref": "unknown:insert"}, {"_type": "tag", "name": "resources", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^    resources: Optional[List[Dict[str, Any]]] = Field(None, description=\"Array of resources\")$/", "language": "Python", "typeref": "typename:Optional[List[Dict[str, Any]]]", "kind": "variable", "scope": "SeedAllBody", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^router = APIRouter(prefix=\"\\/_internal\\/seed\", tags=[\"Seed\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "seed_all", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def seed_all($/", "language": "Python", "kind": "function", "signature": "( body: Optional[SeedAllBody] = Body(default=None), _: None = Depends(internal_seed_guard), session: AsyncSession = Depends(get_session), )"}, {"_type": "tag", "name": "seed_default", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def seed_default($/", "language": "Python", "kind": "function", "signature": "( body: Optional[SeedAllBody] = Body(default=None), _: None = Depends(internal_seed_guard), session: AsyncSession = Depends(get_session), )"}, {"_type": "tag", "name": "seed_one", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def seed_one($/", "language": "Python", "kind": "function", "signature": "( entity: str, body: Optional[List[Dict[str, Any]]] = Body(default=None), _: None = Depends(internal_seed_guard), session: AsyncSession = Depends(get_session), )"}, {"_type": "tag", "name": "seed_verify", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^async def seed_verify($/", "language": "Python", "typeref": "typename:SeedVerifyResponse", "kind": "function", "signature": "( _: None = Depends(internal_seed_guard), session: AsyncSession = Depends(get_session), )"}, {"_type": "tag", "name": "users", "path": "/home/kavia/workspace/code-generation/cloudunify-pro-284073-286483/Backend/fastapi_app/app/api/v1/endpoints/seed.py", "pattern": "/^    users: Optional[List[Dict[str, Any]]] = Field(None, description=\"Array of users\")$/", "language": "Python", "typeref": "typename:Optional[List[Dict[str, Any]]]", "kind": "variable", "scope": "SeedAllBody", "scopeKind": "class"}], "hash": "2facd2d225a13fef940b3c17591263e8", "format-version": 4, "code-base-name": "Backend", "filename": "Backend/fastapi_app/app/api/v1/endpoints/seed.py", "fields": [{"name": "ENTITIES = (\"organizations\", \"users\", \"resources\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_pwd_ctx = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, int] counts", "scope": "SeedVerifyResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "bool ok", "scope": "SeedVerifyResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[List[Dict[str, Any]]] organizations", "scope": "SeedAllBody", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[List[Dict[str, Any]]] resources", "scope": "SeedAllBody", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/_internal\\/seed\", tags=[\"Seed\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[List[Dict[str, Any]]] users", "scope": "SeedAllBody", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"181": ""}]}